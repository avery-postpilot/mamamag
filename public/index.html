<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MamaMag Placement Reservation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Main Styles */
        :root {
            --primary-color: #ff69b4;
            --primary-light: rgba(255, 105, 180, 0.1);
            --text-color: #333;
            --bg-color: #f9f2f4;
            --card-bg: #fff;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        header img {
            max-width: 250px;
            margin-bottom: 15px;
        }
        
        header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            color: #666;
        }
        
        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .card h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .required:after {
            content: " *";
            color: var(--primary-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .char-counter {
            display: block;
            text-align: right;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Magazine Layout Styles */
        .magazine-layout {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .magazine-pages {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            width: 100%;
        }
        
        .page {
            position: relative;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            min-height: 500px;
            aspect-ratio: 0.7727272727; /* 8.5x11 ratio */
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .page:hover:not(.unavailable) {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Single page covers */
        .page.front-cover,
        .page.back-cover {
            grid-column: 1 / -1;
            max-width: 500px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Center spread styling */
        .page[id="spread-7-8"] {
            grid-column: 1 / -1;
            aspect-ratio: 1.545454545; /* Double width (17x11 ratio) */
            max-width: none;
            background: linear-gradient(135deg, #f0f4f8 0%, #d8e2ed 100%);
        }
        
        /* Facing pages indicators */
        .page[data-facing-page]:after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            background: var(--primary-light);
            border: 1px solid var(--primary-color);
        }
        
        .page[data-facing-page]:nth-child(odd):after {
            right: -21px;
            border-radius: 0 20px 20px 0;
            border-left: none;
        }
        
        .page[data-facing-page]:nth-child(even):after {
            left: -21px;
            border-radius: 20px 0 0 20px;
            border-right: none;
        }
        
        .front-cover .cover-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }
        
        .cover-logo {
            font-size: 3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
            letter-spacing: 0.2em;
        }
        
        .cover-issue {
            font-size: 1.2rem;
            color: #666;
            font-style: italic;
        }
        
        .back-cover {
            background: linear-gradient(135deg, #c3cfe2 0%, #f5f7fa 100%);
        }
        
        .toc-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1rem;
        }
        
        .toc-header {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            text-align: center;
            color: #333;
        }
        
        .toc-lines {
            flex: 1;
            background: repeating-linear-gradient(
                transparent,
                transparent 24px,
                #eee 24px,
                #eee 25px
            );
        }
        
        .toc-product {
            margin-top: 1rem;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 4px;
            text-align: center;
            color: #666;
        }
        
        .page-number {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.9rem;
            color: #999;
        }
        
        .page-info {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .page-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .premium-tag {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }
        
        .page-price {
            color: #2c5282;
            font-weight: bold;
        }
        
        .reserved-by {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }
        
        .layout-options {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
            width: 80%;
        }
        
        .page:hover .layout-options {
            display: block;
        }
        
        .layout-option {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .layout-option:hover {
            background-color: #f5f5f5;
        }
        
        .layout-option-icon {
            margin-right: 1rem;
            font-size: 1.5rem;
            color: #666;
        }
        
        .layout-option-details {
            flex: 1;
        }
        
        .layout-option-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .layout-option-description {
            font-size: 0.9rem;
            color: #666;
        }
        
        .page.unavailable {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .page.selected {
            border-color: #4299e1;
            box-shadow: 0 0 0 2px #4299e1;
        }
        
        /* Layout Preview Styles */
        .layout-preview {
            flex: 1;
            margin: 10px 0;
            background-color: #f8f8f8;
            border-radius: 3px;
            position: relative;
            overflow: hidden;
            border: 1px solid #eee;
        }
        
        .layout-full-page {
            background-image: linear-gradient(45deg, #f0f0f0 25%, #e8e8e8 25%, #e8e8e8 50%, #f0f0f0 50%, #f0f0f0 75%, #e8e8e8 75%, #e8e8e8 100%);
            background-size: 20px 20px;
        }
        
        .layout-multi-product {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            padding: 8px;
        }
        
        .layout-multi-product .product-box {
            background-color: #e8e8e8;
            border-radius: 2px;
            min-height: 80px;
        }
        
        .layout-text-image {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 8px;
        }
        
        .layout-text-image .text-area {
            background-color: #e8e8e8;
            border-radius: 2px;
            padding: 8px;
            min-height: 200px;
            background-image: repeating-linear-gradient(#e8e8e8 0px, #e8e8e8 2px, transparent 2px, transparent 16px);
        }
        
        .layout-text-image .image-area {
            background-color: #e0e0e0;
            border-radius: 2px;
            min-height: 200px;
            background-image: linear-gradient(45deg, #d8d8d8 25%, transparent 25%), 
                              linear-gradient(-45deg, #d8d8d8 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #d8d8d8 75%), 
                              linear-gradient(-45deg, transparent 75%, #d8d8d8 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        /* Magazine Section Title */
        .magazine-section {
            text-align: center;
            margin: 0 0 20px;
            padding: 0 20px;
        }
        
        .magazine-section h2 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .magazine-section p {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        /* Spread Indicator */
        .spread-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%), 
                              linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.1) 75%), 
                              linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.1) 75%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
        }
        
        .spread-indicator {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.7;
        }
        
        /* Placement Details Form (Hidden by default) */
        #placement-details {
            display: none;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid var(--primary-color);
        }
        
        #placement-details h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        /* Checkbox style */
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .checkbox-group label {
            display: inline;
            cursor: pointer;
        }
        
        /* Button Styles */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            background-color: #ff45a1;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
            color: #222;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Summary Section Styles */
        .summary-section {
            margin-top: 40px;
        }
        
        .pricing-notice {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .summary-table th {
            background-color: #f5f5f5;
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .summary-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .summary-table tr:last-child td {
            border-bottom: none;
        }
        
        .summary-total {
            text-align: right;
            margin-top: 20px;
            font-size: 1.2rem;
        }
        
        .summary-total span {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.4rem;
        }
        
        /* File Upload Styles */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
        }
        
        .file-upload input {
            display: none;
        }
        
        .file-upload label {
            cursor: pointer;
            display: block;
            margin: 0;
        }
        
        .file-upload-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #888;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-item {
            background-color: #f5f5f5;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .file-item .remove-file {
            margin-left: 8px;
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .magazine-layout {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .card {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
        
        /* Loading Indicator */
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success/Error Messages */
        .message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Multi-Product Styles */
        .product-group {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .product-group h5 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .additional-products {
            margin-top: 20px;
        }
        
        .additional-products .form-group {
            margin-bottom: 15px;
        }
        
        .additional-products .char-counter {
            font-size: 0.8rem;
            color: #666;
            display: block;
            text-align: right;
            margin-top: 5px;
        }
        
        .additional-products .file-upload {
            margin: 10px 0;
        }
        
        /* Responsive adjustments for multi-product layout */
        @media (min-width: 768px) {
            .additional-products {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }
        
        @media (max-width: 767px) {
            .product-group {
                margin-bottom: 20px;
            }
        }
        
        .page-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .preview-cover {
            text-align: center;
        }
        
        .preview-cover img {
            max-width: 100%;
            height: auto;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .preview-cover h2 {
            font-size: 24px;
            color: #333;
            margin: 0;
        }
        
        .preview-content {
            padding: 15px;
        }
        
        .preview-content h3 {
            font-size: 20px;
            color: #333;
            margin: 0 0 10px 0;
        }
        
        .preview-content p {
            color: #666;
            line-height: 1.5;
            margin: 0 0 15px 0;
        }
        
        .layout-preview {
            background: #f5f5f5;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            color: #666;
        }
        
        #pagePreview {
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Page selection styles */
        .magazine-page {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .magazine-page:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .magazine-page.selected {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        /* Preview styles */
        .page-preview {
            margin-top: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .preview-cover {
            text-align: center;
            padding: 20px;
        }
        
        .preview-cover img {
            max-width: 100%;
            height: auto;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .preview-cover h2 {
            font-size: 24px;
            color: #333;
            margin: 10px 0;
        }
        
        .preview-content {
            padding: 15px;
        }
        
        .preview-content h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .preview-content p {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .layout-preview {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            color: #555;
        }
        
        /* Form visibility */
        #assetForm {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Update modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            position: relative;
            background-color: #fff;
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f5f5f5;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: var(--primary-color);
            color: white;
        }
        
        #placement-details {
            display: block;
            background-color: #fff;
            padding: 25px 0;
        }
        
        #placement-details h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
        }
        
        #selected-pages-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .selected-page-item {
            background: #fff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .selected-page-item:last-child {
            margin-bottom: 0;
        }
        
        .selected-page-item .page-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
            padding: 0;
            border: none;
        }
        
        .selected-page-item .page-price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        /* Add styles for selected count */
        .selected-count {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: none;
        }
        
        .selected-count.show {
            display: block;
        }
        
        /* Add styles for selected pages list */
        .selected-page-item {
            background: #f8f9fa;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .selected-page-item .page-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-page-item .page-price {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        #selected-pages-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: #fff;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }
        
        .product-form {
            background: #fff;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .product-form h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .multi-product-container {
            background: #f8f9fa;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
        }
        
        .additional-product {
            background: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .remove-product-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .add-product-btn {
            margin-top: 10px;
        }
        
        #page-product-forms {
            margin-bottom: 30px;
        }
        
        .price-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .currency-symbol {
            position: absolute;
            left: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .product-price,
        .additional-product-price {
            padding-left: 25px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="mamamag-logo.svg" alt="MamaMag Logo">
            <h1>MamaMag Placement Reservation</h1>
            <p>Spring 2025 Edition - Maternity in Style</p>
            <div class="campaign-details">
                <p><strong>Distribution:</strong> <span id="volume-display">50,000</span> copies</p>
                <p><strong>In-Home Date:</strong> <span id="in-home-display">May 15, 2025</span></p>
            </div>
        </header>
        
        <form id="reservation-form">
            <!-- Brand Information Section -->
            <div class="card">
                <h2>Brand Information</h2>
                <div class="form-group">
                    <label for="brand-name" class="required">Brand Name</label>
                    <input type="text" id="brand-name" name="brandName" required>
                </div>
                
                <div class="form-group">
                    <label for="contact-name" class="required">Contact Name</label>
                    <input type="text" id="contact-name" name="contactName" required>
                </div>
                
                <div class="form-group">
                    <label for="contact-email" class="required">Contact Email</label>
                    <input type="email" id="contact-email" name="contactEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="mailing-address" class="required">Mailing Address</label>
                    <textarea id="mailing-address" name="mailingAddress" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="brand-logo" class="required">Brand Logo</label>
                    <div class="file-upload">
                        <label for="brand-logo">
                            <div class="file-upload-icon">📁</div>
                            <p>Click to upload your logo (SVG or PNG)</p>
                        </label>
                        <input type="file" id="brand-logo" name="brandLogo" accept=".svg,.png">
                    </div>
                    <div class="file-list" id="logo-file-list"></div>
                </div>
                
                <div class="form-group">
                    <label for="brand-url" class="required">Brand Website</label>
                    <input type="url" id="brand-url" name="brandUrl" placeholder="https://yourbrand.com" required>
                </div>
            </div>
            
            <!-- Magazine Layout Selection Section -->
            <div class="card">
                <div class="magazine-section">
                <h2>Select Your Placement(s)</h2>
                    <p>Choose from our premium cover positions or standard pages with three beautiful layout options to showcase your brand.</p>
                </div>
                
                <div class="magazine-layout" id="magazine-layout">
                    <!-- Pages will be dynamically generated here via JavaScript -->
                </div>
                
                <!-- Placement Details Form (Hidden until page is selected) -->
                <div id="placement-modal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                <div id="placement-details">
                            <h3>Selected Pages</h3>
                            <div id="selected-pages-list">
                                <!-- Selected pages will be listed here -->
                    </div>
                    
                            <div id="page-product-forms">
                                <!-- Individual product forms will be generated here -->
                    </div>
                    
                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" id="cancel-placement-btn">Cancel</button>
                                <button type="button" class="btn" id="add-placement-btn">Add Placements</button>
                    </div>
                    </div>
                        </div>
                </div>
            </div>
            
            <!-- Summary Section -->
            <div class="card summary-section">
                <h2>Your Selected Placements</h2>
                
                <div class="pricing-notice">
                    <p><strong>Please Note:</strong> The prices shown are suggested prices based on our standard rate card. Any previously negotiated volume discounts or special rates will be honored when you are invoiced. If you have questions about pricing or want to discuss rates, please contact your account manager.</p>
                </div>
                
                <div id="empty-selection-message">
                    <p>No placements selected yet. Click on a page in the magazine layout above to add a placement.</p>
                </div>
                
                <table class="summary-table" id="summary-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Page</th>
                            <th>Placement Type</th>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="summary-body">
                        <!-- Selected placements will appear here -->
                    </tbody>
                </table>
                
                <div class="summary-total">
                    Total: <span id="total-price">$0</span>
                </div>
                
                <div class="message success" id="success-message">
                    Your reservation has been submitted successfully!
                </div>
                
                <div class="message error" id="error-message">
                    There was an error submitting your reservation. Please try again.
                </div>
                
                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p>Submitting your reservation...</p>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn" id="submit-btn">Submit Reservation</button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="selected-count" id="selected-count">
        <span id="selected-count-text">0</span> pages selected
        <button class="btn" id="view-selected-btn">View Selected</button>
    </div>
    
    <!-- Add templates at the end of the body -->
    <template id="product-form-template">
        <div class="product-form" data-page-id="">
            <h4 class="page-title"></h4>
            <div class="form-group">
                <label for="product-name" class="required">Product Name</label>
                <input type="text" class="product-name" name="productName" required>
            </div>
            <div class="form-group">
                <label for="product-price" class="required">Product Price</label>
                <div class="price-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="product-price" name="productPrice" min="0" step="0.01" required>
                </div>
            </div>
            <div class="form-group">
                <label for="product-description" class="required">Product Description</label>
                <textarea class="product-description" name="productDescription" rows="3" required></textarea>
                <div class="char-counter">0/75 characters</div>
            </div>
            <div class="form-group">
                <label for="product-images" class="required">Product Images</label>
                <div class="file-upload">
                    <label>
                        <div class="file-upload-icon">📁</div>
                        <p>Click to upload product images (PNG or JPG)</p>
                    </label>
                    <input type="file" class="product-images" name="productImages" accept=".png,.jpg,.jpeg" multiple>
                </div>
                <div class="file-list"></div>
            </div>
            <div class="form-group">
                <label for="layout-select" class="required">Layout Option</label>
                <select class="layout-select" name="layoutSelect" required>
                    <option value="">Select a layout...</option>
                    <option value="full-page">Full Page Image</option>
                    <option value="multi-product">Multiple Products</option>
                    <option value="text-image">Text with Image</option>
                </select>
            </div>
            <div class="multi-product-container" style="display: none;">
                <h5>Additional Products</h5>
                <div class="additional-products">
                    <!-- Additional product fields will be added here -->
                </div>
                <button type="button" class="btn btn-secondary add-product-btn">+ Add Product</button>
            </div>
        </div>
    </template>

    <template id="additional-product-template">
        <div class="additional-product">
            <div class="form-group">
                <label class="required">Product Name</label>
                <input type="text" class="additional-product-name" required>
            </div>
            <div class="form-group">
                <label class="required">Product Price</label>
                <div class="price-input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" class="additional-product-price" min="0" step="0.01" required>
                </div>
            </div>
            <div class="form-group">
                <label class="required">Product Description</label>
                <textarea class="additional-product-description" rows="2" required></textarea>
                <div class="char-counter">0/75 characters</div>
            </div>
            <div class="form-group">
                <label class="required">Product Images</label>
                <div class="file-upload">
                    <label>
                        <div class="file-upload-icon">📁</div>
                        <p>Click to upload product images</p>
                    </label>
                    <input type="file" class="additional-product-images" accept=".png,.jpg,.jpeg" multiple>
                </div>
                <div class="file-list"></div>
            </div>
            <button type="button" class="btn btn-secondary remove-product-btn">Remove Product</button>
        </div>
    </template>
    
    <script>
        // Campaign and Magazine Layout Data
        const campaignData = {
            campaignId: "MM-SP25",
            campaignName: "Spring 2025 - Maternity in Style",
            volume: 50000,
            inHomeDate: "2025-05-15"
        };
        
        // Magazine Layout Data
        const magazineData = {
            campaignId: campaignData.campaignId,
            campaignName: campaignData.campaignName,
            pages: [
                {
                    id: "front-cover",
                    pageNumber: "Cover",
                    name: "Front Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 10000,
                    available: true,
                    layoutOptions: false
                },
                {
                    id: "front-inside-cover",
                    pageNumber: "1",
                    name: "Front Inside Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 7000,
                    available: true,
                    layoutOptions: false,
                    facingPage: "toc"
                },
                {
                    id: "toc",
                    pageNumber: "2",
                    name: "Table of Contents",
                    type: "Premium",
                    basePrice: 500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: false,
                    facingPage: "front-inside-cover"
                },
                {
                    id: "page-3",
                    pageNumber: "3",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-4"
                },
                {
                    id: "page-4",
                    pageNumber: "4",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-3"
                },
                {
                    id: "page-5",
                    pageNumber: "5",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-6"
                },
                {
                    id: "page-6",
                    pageNumber: "6",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-5"
                },
                {
                    id: "spread-7-8",
                    pageNumber: "7-8",
                    name: "Center Spread",
                    type: "Premium",
                    basePrice: 15000,
                    additionalPremium: 8000,
                    available: true,
                    layoutOptions: false,
                    isSpread: true
                },
                {
                    id: "page-9",
                    pageNumber: "9",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-10"
                },
                {
                    id: "page-10",
                    pageNumber: "10",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-9"
                },
                {
                    id: "page-11",
                    pageNumber: "11",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-12"
                },
                {
                    id: "page-12",
                    pageNumber: "12",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "page-11"
                },
                {
                    id: "page-13",
                    pageNumber: "13",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true,
                    layoutOptions: true,
                    facingPage: "back-inside-cover"
                },
                {
                    id: "back-inside-cover",
                    pageNumber: "14",
                    name: "Back Inside Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 5000,
                    available: true,
                    layoutOptions: false,
                    facingPage: "page-13"
                },
                {
                    id: "back-cover",
                    pageNumber: "Back",
                    name: "Back Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 7000,
                    available: true,
                    layoutOptions: false
                }
            ]
        };
        
        // Layout options configuration
        const layoutOptions = {
            fullPage: {
                id: 'full-page',
                title: 'Full Page Image',
                description: 'One large impactful image with minimal text',
                icon: '🖼️',
                preview: 'layout-full-page'
            },
            multiProduct: {
                id: 'multi-product',
                title: 'Multiple Products',
                description: 'Showcase up to 4 products with details',
                icon: '🏷️',
                preview: 'layout-multi-product'
            },
            textImage: {
                id: 'text-image',
                title: 'Text with Image',
                description: 'Article-style layout with text and images',
                icon: '📝',
                preview: 'layout-text-image'
            }
        };
        
        // Store the selected placements with layout information
        const selectedPlacements = {};
        
        // Additional state to track facing pages
        const spreadSelections = {};
        
        // DOM Elements
        const magazineLayout = document.getElementById('magazine-layout');
        const placementDetails = document.getElementById('placement-details');
        const selectedPageName = document.getElementById('selected-page-name');
        const selectedPageId = document.getElementById('selected-page-id');
        const addPlacementBtn = document.getElementById('add-placement-btn');
        const cancelPlacementBtn = document.getElementById('cancel-placement-btn');
        const summaryTable = document.getElementById('summary-table');
        const summaryBody = document.getElementById('summary-body');
        const emptySelectionMessage = document.getElementById('empty-selection-message');
        const totalPriceElement = document.getElementById('total-price');
        const productCopy = document.getElementById('product-copy');
        const copyCounter = document.getElementById('copy-counter');
        const articleCopy = document.getElementById('article-copy');
        const articleCounter = document.getElementById('article-counter');
        const reservationForm = document.getElementById('reservation-form');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const loader = document.getElementById('loader');
        
        // File Upload Elements
        const brandLogo = document.getElementById('brand-logo');
        const logoFileList = document.getElementById('logo-file-list');
        const productImages = document.getElementById('product-images');
        const imagesFileList = document.getElementById('images-file-list');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderMagazineLayout();
            setupEventListeners();
            setupMultiProductEventListeners();
            updateCampaignDisplayInfo();
            
            // Check for campaign parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const campaignParam = urlParams.get('campaign');
            if (campaignParam) {
                // Load campaign data based on parameter
                loadCampaignData(campaignParam);
            }
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Add event listeners for modal close buttons
            const closeModalBtn = document.querySelector('.close-modal');
            const cancelPlacementBtn = document.getElementById('cancel-placement-btn');
            
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
            }
            
            if (cancelPlacementBtn) {
                cancelPlacementBtn.addEventListener('click', closeModal);
            }
            
            // Add click outside modal to close
            window.addEventListener('click', (event) => {
                const modal = document.getElementById('placement-modal');
                if (event.target === modal) {
                    closeModal();
                }
            });

            // Add event listener for view selected button
            const viewSelectedBtn = document.getElementById('view-selected-btn');
            if (viewSelectedBtn) {
                viewSelectedBtn.addEventListener('click', () => {
                    const selectedPages = document.querySelectorAll('.page.selected');
                    if (selectedPages.length > 0) {
                        const modal = document.getElementById('placement-modal');
                        modal.style.display = 'block';
                        showPlacementModal();
                    }
                });
            }

            // Add event listener for add placement button
            const addPlacementBtn = document.getElementById('add-placement-btn');
            if (addPlacementBtn) {
                addPlacementBtn.addEventListener('click', () => {
                    // Validate form fields
                    const forms = document.querySelectorAll('.product-form');
                    let isValid = true;

                    forms.forEach(form => {
                        const requiredFields = form.querySelectorAll('[required]');
                        requiredFields.forEach(field => {
                            if (!field.value) {
                                isValid = false;
                                field.classList.add('invalid');
                            } else {
                                field.classList.remove('invalid');
                            }
                        });
                    });

                    if (!isValid) {
                        alert('Please fill in all required fields before adding placements.');
                        return;
                    }

                    // Process the form data
                    const formData = collectFormData();
                    
                    // Update summary table
                    updateSummaryTable(formData);
                    
                    // Update total price
                    updateTotalPrice();
                    
                    // Show summary table and hide empty message
                    document.getElementById('summary-table').style.display = 'table';
                    document.getElementById('empty-selection-message').style.display = 'none';
                    
                    // Close the modal
                    closeModal();
                });
            }

            // Add event listeners for file uploads
            const brandLogo = document.getElementById('brand-logo');
            const logoFileList = document.getElementById('logo-file-list');
            if (brandLogo && logoFileList) {
                brandLogo.addEventListener('change', () => handleFileUpload(brandLogo, logoFileList));
            }

            // Add event listeners for character counters
            const productCopy = document.getElementById('product-copy');
            const copyCounter = document.getElementById('copy-counter');
            if (productCopy && copyCounter) {
                productCopy.addEventListener('input', () => {
                    copyCounter.textContent = `${productCopy.value.length}/75 characters`;
                });
            }

            const articleCopy = document.getElementById('article-copy');
            const articleCounter = document.getElementById('article-counter');
            if (articleCopy && articleCounter) {
                articleCopy.addEventListener('input', () => {
                    articleCounter.textContent = `${articleCopy.value.length}/700 characters`;
                });
            }

            // Add form submission handler
            const reservationForm = document.getElementById('reservation-form');
            if (reservationForm) {
                reservationForm.addEventListener('submit', submitReservation);
            }
        }

        // Handle file uploads for images
        function handleFileUpload(input, fileListElement, isProduct = false) {
            if (!input || !fileListElement) return;

            const files = input.files;
            if (!files || files.length === 0) return;

            // Clear existing file list
            fileListElement.innerHTML = '';

            // Create list of uploaded files with previews
            Array.from(files).forEach(file => {
                const listItem = document.createElement('div');
                listItem.className = 'file-item';

                // Create image preview if it's an image file
                if (file.type.startsWith('image/')) {
                    const preview = document.createElement('img');
                    preview.className = 'file-preview';
                    preview.src = URL.createObjectURL(file);
                    preview.onload = () => URL.revokeObjectURL(preview.src);
                    listItem.appendChild(preview);
                }

                // Add file name and size
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                fileInfo.textContent = `${file.name} (${(file.size / 1024).toFixed(1)}KB)`;
                listItem.appendChild(fileInfo);

                // Add remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-file';
                removeBtn.textContent = '×';
                removeBtn.onclick = () => {
                    listItem.remove();
                    // Update the file input
                    const dt = new DataTransfer();
                    Array.from(input.files).forEach(f => {
                        if (f !== file) dt.items.add(f);
                    });
                    input.files = dt.files;
                    // Update validation message
                    updateValidationMessage(input, fileListElement, isProduct);
                };
                listItem.appendChild(removeBtn);

                fileListElement.appendChild(listItem);
            });

            // Update validation message
            updateValidationMessage(input, fileListElement, isProduct);
        }

        function updateValidationMessage(input, fileListElement, isProduct) {
            const files = input.files;
            const validationMsg = fileListElement.querySelector('.validation-message') || document.createElement('div');
            validationMsg.className = 'validation-message';
            
            if (isProduct) {
                if (!files || files.length < 3) {
                    validationMsg.textContent = 'Please upload at least 3 product images';
                    validationMsg.style.color = 'red';
                } else {
                    validationMsg.textContent = 'Image requirements met';
                    validationMsg.style.color = 'green';
                }
                if (!fileListElement.contains(validationMsg)) {
                    fileListElement.appendChild(validationMsg);
                }
            }
        }

        // Handle form submission
        function submitReservation() {
            const form = document.getElementById('reservation-form');
            if (!form) return;

            // Validate selected pages
            const selectedPages = document.querySelectorAll('.magazine-page.selected');
            if (selectedPages.length === 0) {
                alert('Please select at least one page for placement.');
                return;
            }

            // Validate product images
            const productImages = document.querySelectorAll('.product-images input[type="file"]');
            let hasValidImages = true;
            productImages.forEach(input => {
                if (input.files.length < 3) {
                    hasValidImages = false;
                    const parentForm = input.closest('.product-form');
                    if (parentForm) {
                        const validationMsg = parentForm.querySelector('.validation-message');
                        if (validationMsg) {
                            validationMsg.style.color = 'red';
                        }
                    }
                }
            });

            if (!hasValidImages) {
                alert('Please upload at least 3 product images for each product.');
                return;
            }

            // Process form data
            const formData = new FormData(form);
            const placements = [];

            selectedPages.forEach(page => {
                const pageId = page.dataset.pageId;
                const layout = formData.get(`layout-${pageId}`);
                const productName = formData.get(`product-name-${pageId}`);
                const productDescription = formData.get(`product-description-${pageId}`);
                const images = Array.from(page.querySelectorAll('.product-images input[type="file"]')).map(input => input.files[0]);

                if (productName && productDescription && images.length >= 3) {
                    placements.push({
                        pageId,
                        layout,
                        productName,
                        productDescription,
                        images
                    });
                }
            });

            if (placements.length === 0) {
                alert('Please fill out all required fields for at least one placement.');
                return;
            }

            // Add placements to the form data
            formData.append('placements', JSON.stringify(placements));

            // Submit the form
            fetch('/api/reservations', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Reservation submitted successfully!');
                    form.reset();
                    // Reset page selections
                    document.querySelectorAll('.magazine-page.selected').forEach(page => {
                        page.classList.remove('selected');
                    });
                    // Reset selection counter
                    const selectionCounter = document.getElementById('selection-counter');
                    if (selectionCounter) {
                        selectionCounter.style.display = 'none';
                    }
                    // Reset view selected button
                    const viewSelectedBtn = document.getElementById('view-selected-btn');
                    if (viewSelectedBtn) {
                        viewSelectedBtn.style.display = 'none';
                    }
                } else {
                    alert('Error submitting reservation: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while submitting the reservation.');
            });
        }
        
        // Update the campaign information display
        function updateCampaignDisplayInfo() {
            // Format volume with commas
            document.getElementById('volume-display').textContent = campaignData.volume.toLocaleString();
            
            // Format date nicely
            const inHomeDate = new Date(campaignData.inHomeDate);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('in-home-display').textContent = inHomeDate.toLocaleDateString('en-US', options);
        }
        
        // Load campaign data
        function loadCampaignData(campaignId) {
            // In production, this would fetch campaign data from an API
            console.log(`Loading campaign data for: ${campaignId}`);
            // Example: fetch('/api/campaigns/' + campaignId)
            //   .then(response => response.json())
            //   .then(data => updateCampaignData(data));
        }
        
        // Update campaign data
        function updateCampaignData(data) {
            // Update campaign info
            document.querySelector('header h1').textContent = data.name;
            document.querySelector('header p').textContent = data.description;
            
            // Update magazine layout data
            magazineData.campaignId = data.campaignId;
            magazineData.campaignName = data.name;
            magazineData.pages = data.pages;
            
            // Update volume and in-home date if available
            if (data.volume) {
                magazineData.volume = data.volume;
            }
            
            if (data.inHomeDate) {
                magazineData.inHomeDate = data.inHomeDate;
            }
            
            // Update display
            updateCampaignDisplayInfo();
            
            // Re-render layout
            renderMagazineLayout();
        }
        
        // Helper function to create layout preview
        function createLayoutPreview(page) {
            return `
                <div class="layout-preview">
                    <div class="layout-full-page"></div>
                </div>
            `;
        }
        
        // Render the magazine layout
        function renderMagazineLayout() {
            const magazineContainer = document.getElementById('magazine-layout');
            if (!magazineContainer) {
                console.error('Magazine container not found');
                return;
            }

            // Create pages container
            const pagesContainer = document.createElement('div');
            pagesContainer.className = 'magazine-pages';
            
            // Render all pages
            magazineData.pages.forEach((page, index) => {
                const pageElement = document.createElement('div');
                pageElement.className = 'page';
                if (index === 0) pageElement.classList.add('cover-page', 'front-cover');
                if (index === magazineData.pages.length - 1) pageElement.classList.add('cover-page', 'back-cover');
                
                if (!page.available) pageElement.classList.add('unavailable');
                if (selectedPlacements[page.id]) pageElement.classList.add('selected');
                
                pageElement.id = page.id;
                
                // Add facing page data attribute
                if (page.facingPage) {
                    pageElement.dataset.facingPage = page.facingPage;
                }
                
                // Page content
                let content = '';
                if (index === 0) { // Front cover
                    content = `
                        <div class="cover-content">
                            <div class="cover-logo">MAMAMAG</div>
                            <div class="cover-issue">Spring 2025 Edition</div>
                        </div>
                    `;
                } else if (page.id === 'toc') { // Table of contents
                    content = `
                        <div class="toc-content">
                            <div class="toc-header">Table of Contents</div>
                            <div class="toc-lines"></div>
                            <div class="toc-product">Product Feature Slot</div>
                        </div>
                    `;
                } else if (page.id === 'spread-7-8') { // Center spread
                    content = `
                        <div class="spread-content">
                            <div class="spread-indicator">Center Spread</div>
                        </div>
                    `;
                } else if (index === magazineData.pages.length - 1) { // Back cover
                    content = `
                        <div class="cover-content">
                            <div class="cover-logo">MAMAMAG</div>
                        </div>
                    `;
                } else { // Standard pages
                    content = page.layoutOptions ? createLayoutPreview(page) : '';
                }
                
                // Add page number and info
                content += `
                    <div class="page-number">${page.pageNumber}</div>
                    <div class="page-info">
                        <div class="page-title">${page.name}</div>
                        ${page.type === 'Premium' ? '<span class="premium-tag">Premium</span>' : ''}
                        <div class="page-price">$${(page.basePrice + (page.additionalPremium || 0)).toLocaleString()}</div>
                        ${!page.available ? `<div class="reserved-by">Reserved by: ${page.reservedBy || 'Another brand'}</div>` : ''}
                    </div>
                `;
                
                // Add layout options if available
                if (page.layoutOptions && page.available) {
                    content += `
                        <div class="layout-options">
                            ${Object.values(layoutOptions).map(layout => `
                                <div class="layout-option" data-layout="${layout.id}">
                                    <div class="layout-option-icon">${layout.icon}</div>
                                    <div class="layout-option-details">
                                        <div class="layout-option-title">${layout.title}</div>
                                        <div class="layout-option-description">${layout.description}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                pageElement.innerHTML = content;
                pagesContainer.appendChild(pageElement);
            });
            
            // Clear existing content and append new layout
            magazineContainer.innerHTML = '';
            magazineContainer.appendChild(pagesContainer);
            
            // Add event listeners to pages
            addPageEventListeners();
        }
        
        // Add event listeners to pages
        function addPageEventListeners() {
            document.querySelectorAll('.page').forEach(pageElement => {
                const pageId = pageElement.id;
                const page = magazineData.pages.find(p => p.id === pageId);
                
                if (page && page.available) {
                    // Remove any existing click handlers
                    const newPageElement = pageElement.cloneNode(true);
                    pageElement.parentNode.replaceChild(newPageElement, pageElement);
                    
                    // Add new click handler
                    newPageElement.addEventListener('click', () => {
                        // Toggle selection state
                        newPageElement.classList.toggle('selected');
                        
                        // Update selected count
                        updateSelectedCount();
                        
                        // Show/hide view selected button
                        const viewSelectedBtn = document.getElementById('view-selected-btn');
                        if (viewSelectedBtn) {
                            viewSelectedBtn.style.display = document.querySelectorAll('.page.selected').length > 0 ? 'block' : 'none';
                        }
                        
                        // Show placement modal if there are selected pages
                        if (document.querySelectorAll('.page.selected').length > 0) {
                            const modal = document.getElementById('placement-modal');
                            modal.style.display = 'block';
                            showPlacementModal();
                        }
                    });
                    
                    if (page.layoutOptions) {
                        // Add click handlers for layout options
                        newPageElement.querySelectorAll('.layout-option').forEach(option => {
                            option.addEventListener('click', (e) => {
                                e.stopPropagation();
                                const layoutId = option.dataset.layout;
                                const layoutSelect = newPageElement.querySelector('.layout-select');
                                if (layoutSelect) {
                                    layoutSelect.value = layoutId;
                                }
                            });
                        });
                    }
                }
            });
        }
        
        // Select a page in the magazine
        function selectPage(pageId) {
            const pageElement = document.getElementById(pageId);
            const page = magazineData.pages.find(p => p.id === pageId);
            
            if (!page || !page.available) return;
            
            if (selectedPlacements[pageId]) {
                // Deselect the page
                delete selectedPlacements[pageId];
                pageElement.classList.remove('selected');
            } else {
                // Select the page
                selectedPlacements[pageId] = page;
                pageElement.classList.add('selected');
            }
            
            // Update selected count
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            const countElement = document.getElementById('selected-count');
            const countText = document.getElementById('selected-count-text');
            const viewSelectedBtn = document.getElementById('view-selected-btn');
            
            countText.textContent = Object.keys(selectedPlacements).length;
            
            if (Object.keys(selectedPlacements).length > 0) {
                countElement.classList.add('show');
            } else {
                countElement.classList.remove('show');
            }
        }
        
        // Update the modal functionality
        function showPlacementModal() {
            const selectedPages = document.querySelectorAll('.page.selected');
            const modal = document.getElementById('placement-modal');
            const productFormsContainer = document.getElementById('page-product-forms');
            
            if (!modal || !productFormsContainer) return;
            
            // Clear existing forms
            productFormsContainer.innerHTML = '';
            
            // Create a form for each selected page
            selectedPages.forEach(page => {
                const pageId = page.id;
                const pageData = magazineData.pages.find(p => p.id === pageId);
                if (!pageData) return;
                
                // Clone the product form template
                const template = document.getElementById('product-form-template');
                const form = template.content.cloneNode(true);
                
                // Set page-specific data
                const productForm = form.querySelector('.product-form');
                productForm.dataset.pageId = pageId;
                productForm.querySelector('.page-title').textContent = pageData.name;
                
                // Add event listeners for this form
                setupProductForm(productForm);
                
                productFormsContainer.appendChild(form);
            });
            
            // Update selected pages list
            const selectedPagesList = document.getElementById('selected-pages-list');
            if (selectedPagesList) {
                selectedPagesList.innerHTML = '';
                
                selectedPages.forEach(page => {
                    const pageId = page.id;
                    const pageData = magazineData.pages.find(p => p.id === pageId);
                    if (pageData) {
                        const pageItem = document.createElement('div');
                        pageItem.className = 'selected-page-item';
                        pageItem.innerHTML = `
                            <div class="page-info">
                                <strong>${pageData.name}</strong> (Page ${pageData.pageNumber})
                                <span class="page-price">$${(pageData.basePrice + (pageData.additionalPremium || 0)).toLocaleString()}</span>
                            </div>
                        `;
                        selectedPagesList.appendChild(pageItem);
                    }
                });
            }
        }
        
        function setupProductForm(form) {
            const layoutSelect = form.querySelector('.layout-select');
            const multiProductContainer = form.querySelector('.multi-product-container');
            const addProductBtn = form.querySelector('.add-product-btn');
            const additionalProducts = form.querySelector('.additional-products');
            
            // Handle layout selection changes
            layoutSelect.addEventListener('change', (e) => {
                multiProductContainer.style.display = 
                    e.target.value === 'multi-product' ? 'block' : 'none';
            });
            
            // Setup file upload for main product
            const mainFileInput = form.querySelector('.product-images');
            const mainFileList = form.querySelector('.file-list');
            if (mainFileInput && mainFileList) {
                mainFileInput.addEventListener('change', () => {
                    handleFileUpload(mainFileInput, mainFileList, true);
                });
            }
            
            // Setup character counter for main product description
            const mainDescription = form.querySelector('.product-description');
            setupCharacterCounter(mainDescription);
            
            // Handle adding new product fields
            addProductBtn.addEventListener('click', () => {
                const template = document.getElementById('additional-product-template');
                const newProduct = template.content.cloneNode(true);
                
                // Add remove functionality
                const removeBtn = newProduct.querySelector('.remove-product-btn');
                removeBtn.addEventListener('click', (e) => {
                    e.target.closest('.additional-product').remove();
                });
                
                // Setup file upload for additional product
                const fileInput = newProduct.querySelector('.additional-product-images');
                const fileList = newProduct.querySelector('.file-list');
                if (fileInput && fileList) {
                    fileInput.addEventListener('change', () => {
                        handleFileUpload(fileInput, fileList, true);
                    });
                }
                
                // Add character counter for description
                const description = newProduct.querySelector('.additional-product-description');
                setupCharacterCounter(description);
                
                additionalProducts.appendChild(newProduct);
            });
        }
        
        function setupCharacterCounter(textarea) {
            const counter = textarea.nextElementSibling;
            textarea.addEventListener('input', () => {
                const count = textarea.value.length;
                counter.textContent = `${count}/75 characters`;
                counter.style.color = count > 75 ? 'red' : 'inherit';
            });
        }
        
        function setupFileUploadPreview(fileInput) {
            const fileList = fileInput.closest('.form-group').querySelector('.file-list');
            
            fileInput.addEventListener('change', () => {
                fileList.innerHTML = '';
                Array.from(fileInput.files).forEach(file => {
                    const preview = document.createElement('div');
                    preview.className = 'file-preview';
                    
                    if (file.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        preview.appendChild(img);
                    }
                    
                    const name = document.createElement('span');
                    name.textContent = file.name;
                    preview.appendChild(name);
                    
                    fileList.appendChild(preview);
                });
            });
        }
        
        function collectFormData() {
            const forms = document.querySelectorAll('.product-form');
            const formData = new FormData();
            
            forms.forEach(form => {
                const pageId = form.dataset.pageId;
                const layoutType = form.querySelector('.layout-select').value;
                
                // Collect main product data
                const mainProduct = {
                    name: form.querySelector('.product-name').value,
                    price: form.querySelector('.product-price').value,
                    description: form.querySelector('.product-description').value,
                    images: Array.from(form.querySelector('.product-images').files)
                };
                
                // Collect additional products if multi-product layout
                const additionalProducts = [];
                if (layoutType === 'multi-product') {
                    form.querySelectorAll('.additional-product').forEach(addProduct => {
                        additionalProducts.push({
                            name: addProduct.querySelector('.additional-product-name').value,
                            price: addProduct.querySelector('.additional-product-price').value,
                            description: addProduct.querySelector('.additional-product-description').value,
                            images: Array.from(addProduct.querySelector('.additional-product-images').files)
                        });
                    });
                }
                
                // Add to form data
                formData.append(`pages[${pageId}]`, JSON.stringify({
                    layoutType,
                    mainProduct,
                    additionalProducts
                }));
                
                // Append files separately
                mainProduct.images.forEach((file, index) => {
                    formData.append(`pages[${pageId}]_main_images_${index}`, file);
                });
                
                additionalProducts.forEach((product, prodIndex) => {
                    product.images.forEach((file, fileIndex) => {
                        formData.append(
                            `pages[${pageId}]_additional_${prodIndex}_images_${fileIndex}`,
                            file
                        );
                    });
                });
            });
            
            return formData;
        }

        // Fix modal close functionality
        function closeModal() {
            const modal = document.getElementById('placement-modal');
            modal.style.display = 'none';
        }

        // Setup multi-product event listeners
        function setupMultiProductEventListeners() {
            // Setup character counters for all product copy fields
            document.querySelectorAll('.additional-product-copy').forEach(textarea => {
                if (textarea) {
                    const counter = textarea.nextElementSibling;
                    if (counter) {
                        textarea.addEventListener('input', () => {
                            counter.textContent = `${textarea.value.length}/75 characters`;
                        });
                    }
                }
            });

            // Setup file upload handlers for all product images
            document.querySelectorAll('.product-images').forEach((input, index) => {
                if (input) {
                    const fileList = document.querySelector(`.product-${index + 1}-images`);
                    if (fileList) {
                        input.addEventListener('change', () => {
                            handleFileUpload(input, fileList, true);
                        });
                    }
                }
            });

            // Add event listeners for page selection
            document.querySelectorAll('.page').forEach(page => {
                if (page) {
                    page.addEventListener('click', function() {
                        const pageId = this.id;
                        if (pageId) {
                            selectPage(pageId);
                        }
                    });
                }
            });
        }

        // Add new function to update summary table
        function updateSummaryTable(formData) {
            const summaryBody = document.getElementById('summary-body');
            const forms = document.querySelectorAll('.product-form');
            
            forms.forEach(form => {
                const pageId = form.dataset.pageId;
                const pageData = magazineData.pages.find(p => p.id === pageId);
                const productName = form.querySelector('.product-name').value;
                const layoutType = form.querySelector('.layout-select').value;
                
                // Create new row
                    const row = document.createElement('tr');
                row.dataset.pageId = pageId;
                    
                    row.innerHTML = `
                    <td>${pageData.name} (Page ${pageData.pageNumber})</td>
                    <td>${layoutType}</td>
                    <td>${productName}</td>
                    <td>$${(pageData.basePrice + (pageData.additionalPremium || 0)).toLocaleString()}</td>
                    <td>
                        <button type="button" class="btn btn-secondary remove-placement-btn">Remove</button>
                        </td>
                    `;
                    
                // Add remove button handler
                const removeBtn = row.querySelector('.remove-placement-btn');
                removeBtn.addEventListener('click', () => {
                    row.remove();
                delete selectedPlacements[pageId];
                    document.getElementById(pageId).classList.remove('selected');
                    updateSelectedCount();
                    updateTotalPrice();
                    
                    // Show empty message if no placements left
                    if (summaryBody.children.length === 0) {
                        document.getElementById('summary-table').style.display = 'none';
                        document.getElementById('empty-selection-message').style.display = 'block';
                    }
                });
                
                summaryBody.appendChild(row);
            });
        }

        // Add new function to update total price
        function updateTotalPrice() {
            const totalPriceElement = document.getElementById('total-price');
            const summaryBody = document.getElementById('summary-body');
            let total = 0;
            
            Array.from(summaryBody.children).forEach(row => {
                const pageId = row.dataset.pageId;
                const pageData = magazineData.pages.find(p => p.id === pageId);
                if (pageData) {
                    total += pageData.basePrice + (pageData.additionalPremium || 0);
                }
            });
            
            totalPriceElement.textContent = `$${total.toLocaleString()}`;
        }

        function selectPage(pageElement) {
            if (!pageElement) return;

            // Toggle selection state
            pageElement.classList.toggle('selected');
            
            // Update selection counter
            const selectedPages = document.querySelectorAll('.magazine-page.selected');
            const selectionCounter = document.getElementById('selection-counter');
            if (selectionCounter) {
                selectionCounter.textContent = selectedPages.length;
                selectionCounter.style.display = selectedPages.length > 0 ? 'block' : 'none';
            }

            // Show/hide view selected button
            const viewSelectedBtn = document.getElementById('view-selected-btn');
            if (viewSelectedBtn) {
                viewSelectedBtn.style.display = selectedPages.length > 0 ? 'block' : 'none';
            }

            // If this is a facing page, select/deselect the other page
            const pageId = pageElement.dataset.pageId;
            const facingPageId = pageElement.dataset.facingPageId;
            if (facingPageId) {
                const facingPage = document.querySelector(`.magazine-page[data-page-id="${facingPageId}"]`);
                if (facingPage) {
                    facingPage.classList.toggle('selected');
                }
            }

            // Update layout options visibility
            const layoutOptions = document.querySelectorAll('.layout-options');
            layoutOptions.forEach(options => {
                const parentPage = options.closest('.magazine-page');
                if (parentPage && parentPage.classList.contains('selected')) {
                    options.style.display = 'block';
                    } else {
                    options.style.display = 'none';
                }
            });
        }

        function setupLayoutOptions() {
            const layoutOptions = document.querySelectorAll('.layout-option');
            layoutOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options in the same group
                    const parentOptions = option.closest('.layout-options');
                    parentOptions.querySelectorAll('.layout-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Update the hidden input value
                    const pageId = option.closest('.magazine-page').dataset.pageId;
                    const layoutInput = document.querySelector(`input[name="layout-${pageId}"]`);
                    if (layoutInput) {
                        layoutInput.value = option.dataset.layout;
                    }
                });
            });
        }

        // Call this function after rendering the magazine layout
        setupLayoutOptions();
    </script>
</body>
</html>
